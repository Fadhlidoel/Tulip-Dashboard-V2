<!DOCTYPE html>
<html>
<head>
    <title>Quick Debug - Copy Console Output</title>
    <style>
        body { 
            font-family: Arial; 
            padding: 20px; 
            max-width: 800px; 
            margin: 0 auto;
            background: #f5f5f5;
        }
        h1 { color: #333; }
        .box { 
            background: white; 
            border: 2px solid #ddd; 
            padding: 15px; 
            border-radius: 5px;
            margin: 15px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        button:hover { background: #0056b3; }
        textarea {
            width: 100%;
            height: 200px;
            font-family: monospace;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .info { background: #e7f3ff; padding: 10px; border-left: 4px solid #0066cc; margin: 10px 0; }
        .warning { background: #fff3cd; padding: 10px; border-left: 4px solid #ff9800; margin: 10px 0; }
        .success { background: #d4edda; padding: 10px; border-left: 4px solid #28a745; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ”§ Quick ThinkSpeak Debugger</h1>
    
    <div class="info">
        <strong>Instruksi:</strong>
        <ol>
            <li>Buka DevTools (F12) â†’ Console tab</li>
            <li>Klik tombol di bawah</li>
            <li>Lihat output di console dan di kotak textarea</li>
            <li>Copy semua output dan share ke saya</li>
        </ol>
    </div>

    <div class="box">
        <button onclick="runFullDiagnostics()">â–¶ï¸ RUN FULL DIAGNOSTICS</button>
    </div>

    <div class="box">
        <h3>Console Output:</h3>
        <textarea id="output" readonly></textarea>
    </div>

    <div class="box">
        <h3>Key Findings:</h3>
        <div id="findings"></div>
    </div>

    <script>
        const output = [];
        
        function log(msg) {
            console.log(msg);
            output.push(msg);
            document.getElementById('output').value = output.join('\n');
        }

        async function runFullDiagnostics() {
            output.length = 0;
            document.getElementById('findings').innerHTML = '';
            
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
            log('ğŸ” FULL THINKSPEAK DIAGNOSTICS');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n');

            // 1. Check API Config
            log('ğŸ“‹ 1. API CONFIGURATION');
            log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
            const CHANNEL_ID = '3182232';
            const READ_API_KEY = 'Q4EK1PMPN150NY25';
            const url = `https://api.thingspeak.com/channels/${CHANNEL_ID}/feeds.json?results=1&api_key=${READ_API_KEY}`;
            log('Channel ID: ' + CHANNEL_ID);
            log('API Key: ' + READ_API_KEY);
            log('URL: ' + url);
            log('');

            // 2. Try to fetch
            log('ğŸ“¡ 2. FETCHING DATA');
            log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
            
            try {
                log('Sending request...');
                const response = await fetch(url);
                log('âœ… Response received');
                log('Status: ' + response.status + ' ' + (response.ok ? '(OK)' : '(ERROR)'));
                
                const json = await response.json();
                log('âœ… JSON parsed');
                
                log('\nğŸ” 3. RESPONSE STRUCTURE');
                log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                log('Keys in response: ' + Object.keys(json).join(', '));
                
                if (json.channel) {
                    log('Channel found: ' + json.channel.name);
                }
                
                if (!json.feeds) {
                    log('âŒ ERROR: No feeds array!');
                    return;
                }
                
                log('Number of feeds: ' + json.feeds.length);
                
                if (json.feeds.length === 0) {
                    log('âŒ ERROR: Feeds array is empty!');
                    return;
                }

                const feed = json.feeds[0];
                log('\nğŸ“¦ 4. LATEST FEED DATA');
                log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                log('Feed ID: ' + feed.id);
                log('Created at: ' + feed.created_at);
                log('Keys in feed: ' + Object.keys(feed).join(', '));
                
                log('\nğŸ“Š 5. FIELD VALUES (CRITICAL CHECK)');
                log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                
                const fieldCheck = {};
                for (let i = 1; i <= 8; i++) {
                    const field = `field${i}`;
                    const val = feed[field];
                    const isEmpty = val === null || val === undefined || val === '';
                    const parsed = parseFloat(val);
                    
                    fieldCheck[field] = {
                        raw: val,
                        isEmpty: isEmpty,
                        parsed: parsed,
                        isNaN: isNaN(parsed)
                    };
                    
                    const status = isEmpty ? 'âŒ KOSONG' : 'âœ… ADA';
                    log(`${field}: "${val}" ${status}`);
                    log(`        â†’ parseFloat: ${parsed}, isNaN: ${isNaN(parsed)}`);
                }
                
                log('\nğŸ¯ 6. SENSOR MAPPING CHECK');
                log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                
                const mappings = [
                    { field: 'field1', sensor: 'RADIASI', htmlId: 'radiation-value' },
                    { field: 'field2', sensor: 'CO2', htmlId: 'carbon-value' },
                    { field: 'field3', sensor: 'SUHU âš ï¸', htmlId: 'temperature-value' },
                    { field: 'field4', sensor: 'KELEMBAPAN âš ï¸', htmlId: 'humidity-value' },
                ];
                
                const findings = [];
                
                mappings.forEach(m => {
                    const check = fieldCheck[m.field];
                    const elem = document.getElementById(m.htmlId);
                    const elemStatus = elem ? 'âœ…' : 'âŒ MISSING';
                    
                    log(`${m.field} (${m.sensor}) â†’ #${m.htmlId} ${elemStatus}`);
                    log(`   Value: "${check.raw}" ${check.isEmpty ? '[KOSONG]' : '[ADA]'}`);
                    
                    if (check.isEmpty) {
                        findings.push(`âš ï¸ ${m.sensor} KOSONG di ThinkSpeak`);
                    }
                    if (!elem) {
                        findings.push(`âŒ HTML element #${m.htmlId} TIDAK DITEMUKAN`);
                    }
                });
                
                log('\nâš¡ 7. SIMULATION - UPDATE CARDS');
                log('â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€');
                
                mappings.forEach(m => {
                    const check = fieldCheck[m.field];
                    const decimals = (m.sensor === 'RADIASI') ? 3 : 1;
                    let formatted;
                    
                    if (check.isEmpty || isNaN(check.parsed)) {
                        formatted = '--';
                    } else {
                        formatted = check.parsed.toFixed(decimals);
                    }
                    
                    log(`Would set #${m.htmlId} to: "${formatted}"`);
                });
                
                log('\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
                log('ğŸ“ FINDINGS');
                log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•');
                
                if (findings.length === 0) {
                    log('âœ… SEMUA TERLIHAT NORMAL!');
                } else {
                    findings.forEach(f => log(f));
                }
                
                // Display findings
                document.getElementById('findings').innerHTML = 
                    findings.map(f => `<div class="warning">${f}</div>`).join('') ||
                    '<div class="success">âœ… Tidak ada masalah yang terdeteksi</div>';
                    
            } catch (error) {
                log('âŒ ERROR: ' + error.message);
                log(error.stack);
                document.getElementById('findings').innerHTML = 
                    `<div style="background: #f8d7da; padding: 10px; border-left: 4px solid #dc3545;">
                    âŒ ${error.message}
                    </div>`;
            }
        }

        // Run on page load
        window.addEventListener('load', runFullDiagnostics);
    </script>
</body>
</html>
